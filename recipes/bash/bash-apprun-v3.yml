version: 1
script:
  - echo $PWD
  - mkdir -p $TARGET_APPDIR/bin
  - cp run_tests.sh $TARGET_APPDIR
  - cp -r tests $TARGET_APPDIR

AppDir:
  app_info:
    id: org.gnu.bash
    name: bash
    version: 5.2.21
    exec: bin/bash

  apt:
    arch: [ amd64, i386 ]
    allow_unauthenticated: true
    sources:
      - sourceline: 'deb http://archive.ubuntu.com/ubuntu noble main'
        key_url: 'http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x871920d1991bc93c'

    include:
      - bash
      - coreutils
      - libc6
      - libc6:i386
    exclude:
      - libpcre3

  after_bundle: |
    cd $TARGET_APPDIR
    ln -sr usr/bin/env tests/test_internal_binary_env
    ln -sr /usr/bin/env tests/test_external_binary_env
    mkdir -p bin
    ln -sr usr/bin/bash bin/bash
    ln -sr bin/bash bin/nubash

  files:
    exclude:
      - etc/**
      - usr/share/doc/**/recipes/**
      - usr/include/**
      - usr/lib/*/gconv/**
      - usr/share/man/**
      - usr/share/doc/*/README.*
      - usr/share/doc/*/changelog.*
      - usr/share/doc/*/NEWS.*
      - usr/share/doc/*/TODO.*

  runtime:
    arch: [ x86_64, i386 ]
    version: v3.0.0-devel-1
    debug: true

  test:
    debian:
      image: {{APPIMAGE_BUILDER_REMOTE_REPO_OWNER}}/tests-env:debian-bookworm
      before_command: "pwd"
      command: "./AppRun ./run_tests.sh"
    centos:
      image: {{APPIMAGE_BUILDER_REMOTE_REPO_OWNER}}/tests-env:centos-10
      command: "./AppRun ./run_tests.sh"
    arch:
      image: {{APPIMAGE_BUILDER_REMOTE_REPO_OWNER}}/tests-env:archlinux-latest
      command: "./AppRun ./run_tests.sh"
    fedora:
      image: {{APPIMAGE_BUILDER_REMOTE_REPO_OWNER}}/tests-env:fedora-42
      command: "./AppRun ./run_tests.sh"
    ubuntu:
      image: {{APPIMAGE_BUILDER_REMOTE_REPO_OWNER}}/tests-env:ubuntu-noble
      command: "./AppRun ./run_tests.sh"


AppImage:
  comp: zstd
  arch: x86_64
